#!/usr/bin/env bash

# Get the script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/scripts"

# Load common utilities
source "$SCRIPT_DIR/common/logging.sh"

# Show usage information
show_usage() {
  echo "Usage: $0 COMMAND [OPTIONS]"
  echo 
  echo "Commands:"
  echo "  start       Start the application"
  echo "  stop        Stop the application"
  echo "  status      Check application status"
  echo "  logs        View application logs"
  echo 
  echo "Options:"
  echo "  --local     Use local development environment"
  echo "  --dev       Use development environment"
  echo "  --prod      Use production environment"
  echo "  --help      Show this help message"
  echo 
  echo "Examples:"
  echo "  $0 start --local    # Start the application in local development mode"
  echo "  $0 start --prod     # Start the application in production mode"
  echo "  $0 stop             # Stop the application"
  echo 
  exit 1
}

# Main command dispatcher
main() {
  # Check if command is provided
  if [ $# -eq 0 ]; then
    show_usage
  fi
  
  # Parse first argument as command
  COMMAND="$1"
  shift
  
  # Default environment is local if not specified
  ENVIRONMENT="local"
  
  # Parse options for environment
  for arg in "$@"; do
    case "$arg" in
      --local)
        ENVIRONMENT="local"
        ;;
      --dev)
        ENVIRONMENT="dev"
        ;;
      --prod)
        ENVIRONMENT="prod"
        ;;
      --help)
        show_usage
        ;;
    esac
  done
  
  # Check command and route to proper script
  case "$COMMAND" in
    start)
      # Execute the appropriate script quietly without duplicate logs
      if [ "$ENVIRONMENT" = "local" ]; then
        # Execute the start script directly (it will show its own logs)
        bash "$SCRIPT_DIR/local/start"
      elif [ "$ENVIRONMENT" = "dev" ]; then
        # Will be implemented in the future
        echo "[ERROR] Dev environment not implemented yet"
        exit 1
      elif [ "$ENVIRONMENT" = "prod" ]; then
        # Will be implemented in the future
        echo "[ERROR] Production environment not implemented yet"
        exit 1
      fi
      ;;
    stop)
      echo "[ERROR] Stop command not implemented yet"
      exit 1
      ;;
    status)
      echo "[ERROR] Status command not implemented yet"
      exit 1
      ;;
    logs)
      echo "[ERROR] Logs command not implemented yet"
      exit 1
      ;;
    *)
      echo "[ERROR] Unknown command: $COMMAND"
      show_usage
      ;;
  esac
}

# Execute main function with all arguments
main "$@"
